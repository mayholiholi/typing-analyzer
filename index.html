<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Typing Analyzer</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      color: #1a1a2e;
      min-height: 100vh;
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
    }

    .app {
      max-width: 800px;
      margin: 0 auto;
      padding: 60px 24px;
    }

    /* Hero */
    .hero {
      text-align: center;
      margin-bottom: 48px;
    }

    .hero-title {
      font-size: 48px;
      font-weight: 700;
      color: #1a1a2e;
      margin-bottom: 16px;
      letter-spacing: -0.02em;
    }

    .hero-desc {
      font-size: 18px;
      color: #6c757d;
      max-width: 500px;
      margin: 0 auto;
    }

    /* Cards */
    .card {
      background: #fff;
      border-radius: 20px;
      padding: 32px;
      margin-bottom: 24px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
      border: 1px solid rgba(0, 0, 0, 0.04);
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
    }

    .card-header {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 20px;
    }

    .card-number {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      font-weight: 600;
      color: #fff;
    }

    .card-title {
      font-size: 22px;
      font-weight: 600;
      color: #1a1a2e;
    }

    .card-desc {
      font-size: 15px;
      color: #6c757d;
      margin-bottom: 20px;
    }

    /* Prompt */
    .prompt {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
      border-radius: 10px;
      font-size: 16px;
      font-weight: 500;
      color: #667eea;
      margin-bottom: 16px;
    }

    /* Input */
    input[type="text"] {
      width: 100%;
      padding: 18px 20px;
      font-size: 18px;
      font-family: inherit;
      border: 2px solid #e9ecef;
      border-radius: 14px;
      background: #f8f9fa;
      color: #1a1a2e;
      outline: none;
      transition: all 0.2s;
    }

    input[type="text"]::placeholder {
      color: #adb5bd;
    }

    input[type="text"]:focus {
      border-color: #667eea;
      background: #fff;
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
    }

    /* Stats */
    .stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
      margin-top: 20px;
    }

    .stat-item {
      text-align: center;
      padding: 16px;
      background: #f8f9fa;
      border-radius: 12px;
    }

    .stat-label {
      font-size: 13px;
      color: #6c757d;
      margin-bottom: 4px;
    }

    .stat-value {
      font-size: 20px;
      font-weight: 600;
      color: #1a1a2e;
    }

    .stat-value.ok { color: #20c997; }
    .stat-value.ng { color: #f03e3e; }

    /* Progress */
    .progress-bar {
      width: 100%;
      height: 6px;
      background: #e9ecef;
      border-radius: 3px;
      margin-bottom: 16px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
      border-radius: 3px;
      transition: width 0.1s linear;
    }

    /* Buttons */
    .button-row {
      display: flex;
      gap: 16px;
      margin: 32px 0;
    }

    .btn {
      flex: 1;
      padding: 18px 24px;
      font-size: 17px;
      font-weight: 600;
      font-family: inherit;
      border: none;
      border-radius: 14px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      box-shadow: 0 4px 14px rgba(102, 126, 234, 0.4);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
    }

    .btn-secondary {
      background: #fff;
      color: #6c757d;
      border: 2px solid #e9ecef;
    }

    .btn-secondary:hover {
      background: #f8f9fa;
    }

    /* Result */
    .result-card {
      background: linear-gradient(135deg, #667eea08 0%, #764ba208 100%);
      border: 2px solid #667eea20;
      margin: 32px 0;
    }

    .result-title {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .result-item {
      padding: 12px 0;
      font-size: 16px;
      border-bottom: 1px solid #e9ecef;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .result-item:last-of-type {
      border-bottom: none;
    }

    .result-item.ok { color: #20c997; }
    .result-item.ng { color: #f03e3e; }
    .result-item.info { color: #6c757d; }

    .result-item::before {
      font-size: 14px;
      font-weight: 600;
    }

    .result-item.ok::before { content: 'âœ“'; }
    .result-item.ng::before { content: 'âœ—'; }
    .result-item.info::before { content: 'â€¢'; }

    /* Settings */
    .settings-label {
      font-size: 14px;
      font-weight: 600;
      color: #6c757d;
      margin: 24px 0 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .settings-box {
      background: #fff;
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid #e9ecef;
    }

    .settings-item {
      display: flex;
      justify-content: space-between;
      padding: 16px 20px;
      font-size: 16px;
      border-bottom: 1px solid #e9ecef;
    }

    .settings-item:last-child {
      border-bottom: none;
    }

    .settings-item span:first-child {
      font-weight: 500;
      color: #1a1a2e;
    }

    .settings-item span:last-child {
      color: #6c757d;
    }

    .command-box {
      background: #1a1a2e;
      border-radius: 12px;
      padding: 18px;
      margin: 16px 0;
      font-family: 'SF Mono', Menlo, Consolas, monospace;
      font-size: 14px;
      color: #20c997;
      overflow-x: auto;
      word-break: break-all;
    }

    .note-text {
      font-size: 14px;
      color: #6c757d;
      margin-top: 16px;
    }

    .hidden { display: none; }

    /* Footer */
    footer {
      padding: 48px 24px;
      text-align: center;
    }

    footer a {
      color: #adb5bd;
      text-decoration: none;
      font-size: 14px;
      transition: color 0.2s;
    }

    footer a:hover {
      color: #667eea;
    }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 40px;
      left: 50%;
      transform: translateX(-50%) translateY(20px);
      background: #1a1a2e;
      color: #fff;
      padding: 14px 28px;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 500;
      opacity: 0;
      transition: all 0.3s;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
    }

    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="hero">
      <h1 class="hero-title">Typing Analyzer</h1>
      <p class="hero-desc">ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®ãƒªãƒ”ãƒ¼ãƒˆè¨­å®šã‚’æœ€é©åŒ–ã™ã‚‹ãŸã‚ã®ãƒ†ã‚¹ãƒˆã§ã™</p>
    </div>

    <div class="card">
      <div class="card-header">
        <div class="card-number">1</div>
        <div class="card-title">å˜æ‰“ãƒ†ã‚¹ãƒˆ</div>
      </div>
      <p class="card-desc">ã€Œã‚ã„ã†ãˆãŠã€ã‚’1æ–‡å­—ãšã¤å…¥åŠ›ã—ã¦ãã ã•ã„</p>
      <div class="prompt">ã‚ã„ã†ãˆãŠ</div>
      <input type="text" id="test1-input" placeholder="ã“ã“ã«å…¥åŠ›..." autocomplete="off">
      <div class="stats">
        <div class="stat-item">
          <div class="stat-label">å…¥åŠ›æ•°</div>
          <div class="stat-value" id="test1-count">0</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">èª¤ãƒªãƒ”ãƒ¼ãƒˆ</div>
          <div class="stat-value" id="test1-repeats">0</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">åˆ¤å®š</div>
          <div class="stat-value" id="test1-result">â€”</div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <div class="card-number">2</div>
        <div class="card-title">é•·æŠ¼ã—ãƒ†ã‚¹ãƒˆ</div>
      </div>
      <p class="card-desc">ã€Œaã€ã‚­ãƒ¼ã‚’æŠ¼ã—ç¶šã‘ã¦ãã ã•ã„</p>
      <div class="prompt">ã€Œaã€ã‚’é•·æŠ¼ã—</div>
      <input type="text" id="test2-input" placeholder="ã“ã“ã§ a ã‚’é•·æŠ¼ã—..." autocomplete="off">
      <div class="stats">
        <div class="stat-item">
          <div class="stat-label">é–‹å§‹ã¾ã§</div>
          <div class="stat-value" id="test2-delay">â€”</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">é€Ÿåº¦</div>
          <div class="stat-value" id="test2-rate">â€”</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">åˆ¤å®š</div>
          <div class="stat-value" id="test2-result">â€”</div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <div class="card-number">3</div>
        <div class="card-title">é€£æ‰“ãƒ†ã‚¹ãƒˆ</div>
      </div>
      <p class="card-desc">ã€Œjã€ã‚­ãƒ¼ã‚’5ç§’é–“é€£æ‰“ã—ã¦ãã ã•ã„</p>
      <div class="prompt">ã€Œjã€ã‚’5ç§’é–“é€£æ‰“</div>
      <div class="progress-bar">
        <div class="progress-fill" id="test3-progress" style="width: 0%"></div>
      </div>
      <input type="text" id="test3-input" placeholder="ã“ã“ã§ j ã‚’é€£æ‰“..." autocomplete="off">
      <div class="stats">
        <div class="stat-item">
          <div class="stat-label">æ‰“éµæ•°</div>
          <div class="stat-value" id="test3-count">0</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">é€Ÿåº¦</div>
          <div class="stat-value" id="test3-speed">â€”</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">é–“éš”</div>
          <div class="stat-value" id="test3-interval">â€”</div>
        </div>
      </div>
    </div>

    <div class="button-row">
      <button class="btn btn-primary" onclick="analyzeResults()">åˆ†æã™ã‚‹</button>
      <button class="btn btn-secondary" onclick="resetAll()">ãƒªã‚»ãƒƒãƒˆ</button>
    </div>

    <div class="card result-card hidden" id="result-section">
      <div class="result-title">ğŸ“‹ åˆ†æçµæœ</div>
      <div id="analysis-text"></div>

      <p class="settings-label">æ¨å¥¨è¨­å®š</p>
      <div class="settings-box">
        <div class="settings-item">
          <span>KeyRepeat</span>
          <span id="setting-keyrepeat">â€”</span>
        </div>
        <div class="settings-item">
          <span>InitialKeyRepeat</span>
          <span id="setting-initial">â€”</span>
        </div>
      </div>

      <p class="settings-label">ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚³ãƒãƒ³ãƒ‰</p>
      <div class="command-box" id="recommended-command"></div>
      <button class="btn btn-primary" onclick="copyCommand()" style="width: 100%;">ã‚³ãƒ”ãƒ¼</button>
      <p class="note-text">â€» è¨­å®šå¾Œã¯ãƒ­ã‚°ã‚¢ã‚¦ãƒˆâ†’ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™</p>
    </div>
  </div>

  <footer>
    <a href="https://mayholiholi.github.io/">mayholiholi</a>
  </footer>

  <div class="toast" id="toast"></div>

  <script>
    const test1 = { lastKey: '', lastTime: 0, repeatCount: 0, charCount: 0 };
    const test2 = { keyDownTime: 0, repeatCount: 0, repeatTimes: [], isHolding: false };
    const test3 = { startTime: 0, keyTimes: [], isRunning: false, timerId: null };

    document.getElementById('test1-input').addEventListener('keydown', (e) => {
      const now = Date.now();
      if (e.key === test1.lastKey && now - test1.lastTime < 50) {
        test1.repeatCount++;
        const el = document.getElementById('test1-repeats');
        el.textContent = test1.repeatCount;
        el.classList.add('ng');
      }
      test1.lastKey = e.key;
      test1.lastTime = now;
    });

    document.getElementById('test1-input').addEventListener('input', (e) => {
      test1.charCount = e.target.value.length;
      document.getElementById('test1-count').textContent = test1.charCount;
      const result = document.getElementById('test1-result');
      if (test1.repeatCount === 0 && test1.charCount >= 5) {
        result.textContent = 'OK';
        result.classList.add('ok');
        result.classList.remove('ng');
      } else if (test1.repeatCount > 0) {
        result.textContent = 'NG';
        result.classList.add('ng');
        result.classList.remove('ok');
      }
    });

    document.getElementById('test2-input').addEventListener('keydown', (e) => {
      if (e.key !== 'a') return;
      if (!test2.isHolding) {
        test2.keyDownTime = Date.now();
        test2.isHolding = true;
        test2.repeatCount = 0;
        test2.repeatTimes = [];
      } else {
        const now = Date.now();
        if (test2.repeatCount === 0) {
          document.getElementById('test2-delay').textContent = (now - test2.keyDownTime) + 'ms';
        }
        test2.repeatTimes.push(now);
        test2.repeatCount++;
        if (test2.repeatTimes.length >= 2) {
          const intervals = [];
          for (let i = 1; i < test2.repeatTimes.length; i++) {
            intervals.push(test2.repeatTimes[i] - test2.repeatTimes[i-1]);
          }
          const avg = intervals.reduce((a,b) => a+b, 0) / intervals.length;
          const rate = Math.round(1000 / avg);
          document.getElementById('test2-rate').textContent = rate + '/ç§’';
          const result = document.getElementById('test2-result');
          if (rate > 30) {
            result.textContent = 'é€Ÿã™ã';
            result.classList.add('ng');
            result.classList.remove('ok');
          } else if (rate < 5) {
            result.textContent = 'é…ã™ã';
            result.classList.add('ng');
            result.classList.remove('ok');
          } else {
            result.textContent = 'OK';
            result.classList.add('ok');
            result.classList.remove('ng');
          }
        }
      }
    });

    document.getElementById('test2-input').addEventListener('keyup', (e) => {
      if (e.key === 'a') test2.isHolding = false;
    });

    document.getElementById('test3-input').addEventListener('keydown', (e) => {
      if (e.key !== 'j') return;
      const now = Date.now();
      if (!test3.isRunning) {
        test3.isRunning = true;
        test3.startTime = now;
        test3.keyTimes = [now];
        let elapsed = 0;
        test3.timerId = setInterval(() => {
          elapsed += 100;
          document.getElementById('test3-progress').style.width = Math.min(100, elapsed / 50) + '%';
          if (elapsed >= 5000) {
            clearInterval(test3.timerId);
            test3.isRunning = false;
            document.getElementById('test3-input').blur();
          }
        }, 100);
      } else {
        test3.keyTimes.push(now);
      }
      document.getElementById('test3-count').textContent = test3.keyTimes.length;
      if (test3.keyTimes.length >= 2) {
        const duration = (now - test3.startTime) / 1000;
        document.getElementById('test3-speed').textContent = (test3.keyTimes.length / duration).toFixed(1) + '/ç§’';
        const intervals = [];
        for (let i = 1; i < test3.keyTimes.length; i++) {
          intervals.push(test3.keyTimes[i] - test3.keyTimes[i-1]);
        }
        document.getElementById('test3-interval').textContent = Math.round(intervals.reduce((a,b) => a+b, 0) / intervals.length) + 'ms';
      }
    });

    function analyzeResults() {
      const section = document.getElementById('result-section');
      section.classList.remove('hidden');
      let html = '';
      let keyRepeat = 6, initialKeyRepeat = 25;

      if (test1.repeatCount > 0) {
        html += '<div class="result-item ng">æ„å›³ã—ãªã„ãƒªãƒ”ãƒ¼ãƒˆãŒç™ºç”Ÿ</div>';
        initialKeyRepeat = Math.min(35, initialKeyRepeat + 5 * test1.repeatCount);
      } else if (test1.charCount >= 5) {
        html += '<div class="result-item ok">å˜æ‰“ãƒ†ã‚¹ãƒˆå•é¡Œãªã—</div>';
      }

      const delay = document.getElementById('test2-delay').textContent;
      const rate = document.getElementById('test2-rate').textContent;
      if (delay !== 'â€”') {
        const d = parseInt(delay);
        if (d < 300) {
          html += '<div class="result-item ng">ãƒªãƒ”ãƒ¼ãƒˆé–‹å§‹ãŒé€Ÿã™ã (' + d + 'ms)</div>';
          initialKeyRepeat = Math.max(initialKeyRepeat, 30);
        } else if (d > 800) {
          html += '<div class="result-item info">ãƒªãƒ”ãƒ¼ãƒˆé–‹å§‹ãŒé…ã‚ (' + d + 'ms)</div>';
        } else {
          html += '<div class="result-item ok">ãƒªãƒ”ãƒ¼ãƒˆé–‹å§‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°OK</div>';
        }
      }
      if (rate !== 'â€”') {
        const r = parseInt(rate);
        if (r > 30) {
          html += '<div class="result-item ng">ãƒªãƒ”ãƒ¼ãƒˆé€Ÿåº¦ãŒé€Ÿã™ã (' + r + 'å›/ç§’)</div>';
          keyRepeat = Math.min(10, keyRepeat + 2);
        } else if (r < 8) {
          html += '<div class="result-item info">ãƒªãƒ”ãƒ¼ãƒˆé€Ÿåº¦ãŒé…ã‚</div>';
        } else {
          html += '<div class="result-item ok">ãƒªãƒ”ãƒ¼ãƒˆé€Ÿåº¦OK</div>';
        }
      }

      const interval = document.getElementById('test3-interval').textContent;
      if (interval !== 'â€”') {
        const i = parseInt(interval);
        const speed = document.getElementById('test3-speed').textContent;
        html += '<div class="result-item info">é€£æ‰“é€Ÿåº¦: ' + speed + ' (é–“éš”: ' + i + 'ms)</div>';
        if (i > 150) keyRepeat = Math.max(keyRepeat, 8);
      }

      document.getElementById('analysis-text').innerHTML = html;
      document.getElementById('setting-keyrepeat').textContent = keyRepeat;
      document.getElementById('setting-initial').textContent = initialKeyRepeat;
      document.getElementById('recommended-command').textContent =
        'defaults write NSGlobalDomain KeyRepeat -int ' + keyRepeat + ' && defaults write NSGlobalDomain InitialKeyRepeat -int ' + initialKeyRepeat;
      section.scrollIntoView({ behavior: 'smooth' });
    }

    function copyCommand() {
      navigator.clipboard.writeText(document.getElementById('recommended-command').textContent);
      showToast('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
    }

    function showToast(msg) {
      const t = document.getElementById('toast');
      t.textContent = msg;
      t.classList.add('show');
      setTimeout(() => t.classList.remove('show'), 2000);
    }

    function resetAll() {
      test1.lastKey = ''; test1.lastTime = 0; test1.repeatCount = 0; test1.charCount = 0;
      document.getElementById('test1-input').value = '';
      document.getElementById('test1-count').textContent = '0';
      document.getElementById('test1-repeats').textContent = '0';
      document.getElementById('test1-repeats').classList.remove('ng');
      document.getElementById('test1-result').textContent = 'â€”';
      document.getElementById('test1-result').classList.remove('ok', 'ng');

      test2.keyDownTime = 0; test2.repeatCount = 0; test2.repeatTimes = []; test2.isHolding = false;
      document.getElementById('test2-input').value = '';
      document.getElementById('test2-delay').textContent = 'â€”';
      document.getElementById('test2-rate').textContent = 'â€”';
      document.getElementById('test2-result').textContent = 'â€”';
      document.getElementById('test2-result').classList.remove('ok', 'ng');

      if (test3.timerId) clearInterval(test3.timerId);
      test3.startTime = 0; test3.keyTimes = []; test3.isRunning = false;
      document.getElementById('test3-input').value = '';
      document.getElementById('test3-count').textContent = '0';
      document.getElementById('test3-speed').textContent = 'â€”';
      document.getElementById('test3-interval').textContent = 'â€”';
      document.getElementById('test3-progress').style.width = '0%';

      document.getElementById('result-section').classList.add('hidden');
      showToast('ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ');
    }
  </script>
</body>
</html>
