<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰è¨­å®šã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼</title>
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background: #1a1a2e;
      color: #eee;
      min-height: 100vh;
    }
    h1 {
      text-align: center;
      color: #00d4ff;
    }
    .test-section {
      background: #16213e;
      border-radius: 12px;
      padding: 24px;
      margin: 20px 0;
    }
    .test-section h2 {
      margin-top: 0;
      color: #00d4ff;
      font-size: 1.2em;
    }
    .description {
      color: #aaa;
      font-size: 0.9em;
      margin-bottom: 16px;
    }
    input[type="text"] {
      width: 100%;
      padding: 16px;
      font-size: 24px;
      border: 2px solid #0f3460;
      border-radius: 8px;
      background: #0f0f23;
      color: #fff;
      outline: none;
      transition: border-color 0.2s;
    }
    input[type="text"]:focus {
      border-color: #00d4ff;
    }
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 12px;
      margin-top: 16px;
    }
    .stat-box {
      background: #0f3460;
      padding: 12px;
      border-radius: 8px;
      text-align: center;
    }
    .stat-label {
      font-size: 0.8em;
      color: #aaa;
    }
    .stat-value {
      font-size: 1.5em;
      font-weight: bold;
      color: #00d4ff;
    }
    .warning {
      color: #ff6b6b;
    }
    .success {
      color: #51cf66;
    }
    button {
      background: #00d4ff;
      color: #1a1a2e;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 1em;
      font-weight: bold;
      cursor: pointer;
      margin: 8px 4px;
      transition: transform 0.1s, background 0.2s;
    }
    button:hover {
      background: #00b8e6;
      transform: scale(1.02);
    }
    button:active {
      transform: scale(0.98);
    }
    .result-section {
      background: linear-gradient(135deg, #0f3460, #16213e);
      border: 2px solid #00d4ff;
      border-radius: 12px;
      padding: 24px;
      margin: 20px 0;
    }
    .result-section h2 {
      color: #00d4ff;
      margin-top: 0;
    }
    .command-box {
      background: #0f0f23;
      padding: 16px;
      border-radius: 8px;
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 0.9em;
      overflow-x: auto;
      margin: 12px 0;
    }
    .command-box code {
      color: #51cf66;
    }
    .hidden {
      display: none;
    }
    .progress-bar {
      width: 100%;
      height: 8px;
      background: #0f3460;
      border-radius: 4px;
      overflow: hidden;
      margin: 12px 0;
    }
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #00d4ff, #51cf66);
      transition: width 0.3s;
    }
    .test-prompt {
      font-size: 1.2em;
      color: #ffd43b;
      margin: 12px 0;
      padding: 12px;
      background: rgba(255, 212, 59, 0.1);
      border-radius: 8px;
      text-align: center;
    }
    footer {
      text-align: center;
      margin-top: 40px;
      padding: 20px;
      color: #666;
      font-size: 0.9em;
    }
    footer a {
      color: #00d4ff;
      text-decoration: none;
    }
    footer a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <h1>âŒ¨ï¸ ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰è¨­å®šã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼</h1>

  <div class="test-section">
    <h2>ãƒ†ã‚¹ãƒˆ1: å˜æ‰“ãƒ†ã‚¹ãƒˆ</h2>
    <p class="description">ã€Œã‚ã„ã†ãˆãŠã€ã‚’1æ–‡å­—ãšã¤ã‚†ã£ãã‚Šå…¥åŠ›ã—ã¦ãã ã•ã„ã€‚æ„å›³ã—ãªã„ãƒªãƒ”ãƒ¼ãƒˆãŒç™ºç”Ÿã™ã‚‹ã‹ç¢ºèªã—ã¾ã™ã€‚</p>
    <div class="test-prompt">ã‚ã„ã†ãˆãŠ</div>
    <input type="text" id="test1-input" placeholder="ã“ã“ã«å…¥åŠ›..." autocomplete="off">
    <div class="stats">
      <div class="stat-box">
        <div class="stat-label">å…¥åŠ›æ–‡å­—æ•°</div>
        <div class="stat-value" id="test1-count">0</div>
      </div>
      <div class="stat-box">
        <div class="stat-label">æ„å›³ã—ãªã„ãƒªãƒ”ãƒ¼ãƒˆ</div>
        <div class="stat-value" id="test1-repeats">0</div>
      </div>
      <div class="stat-box">
        <div class="stat-label">åˆ¤å®š</div>
        <div class="stat-value" id="test1-result">-</div>
      </div>
    </div>
  </div>

  <div class="test-section">
    <h2>ãƒ†ã‚¹ãƒˆ2: é•·æŠ¼ã—ãƒ†ã‚¹ãƒˆ</h2>
    <p class="description">ã€Œaã€ã‚­ãƒ¼ã‚’æŠ¼ã—ç¶šã‘ã¦ãã ã•ã„ã€‚ãƒªãƒ”ãƒ¼ãƒˆãŒå§‹ã¾ã‚‹ã¾ã§ã®æ™‚é–“ã¨é€Ÿåº¦ã‚’è¨ˆæ¸¬ã—ã¾ã™ã€‚</p>
    <div class="test-prompt">ã€Œaã€ã‚’é•·æŠ¼ã—</div>
    <input type="text" id="test2-input" placeholder="ã“ã“ã§aã‚’é•·æŠ¼ã—..." autocomplete="off">
    <div class="stats">
      <div class="stat-box">
        <div class="stat-label">ãƒªãƒ”ãƒ¼ãƒˆé–‹å§‹ã¾ã§</div>
        <div class="stat-value" id="test2-delay">-</div>
      </div>
      <div class="stat-box">
        <div class="stat-label">ãƒªãƒ”ãƒ¼ãƒˆé€Ÿåº¦</div>
        <div class="stat-value" id="test2-rate">-</div>
      </div>
      <div class="stat-box">
        <div class="stat-label">åˆ¤å®š</div>
        <div class="stat-value" id="test2-result">-</div>
      </div>
    </div>
  </div>

  <div class="test-section">
    <h2>ãƒ†ã‚¹ãƒˆ3: é€£æ‰“ãƒ†ã‚¹ãƒˆ</h2>
    <p class="description">ã€Œjã€ã‚­ãƒ¼ã‚’5ç§’é–“ã§ãã‚‹ã ã‘é€Ÿãé€£æ‰“ã—ã¦ãã ã•ã„ã€‚ã‚¿ã‚¤ãƒ”ãƒ³ã‚°é€Ÿåº¦ã‚’è¨ˆæ¸¬ã—ã¾ã™ã€‚</p>
    <div class="test-prompt">ã€Œjã€ã‚’5ç§’é–“é€£æ‰“ï¼</div>
    <div class="progress-bar"><div class="progress-fill" id="test3-progress" style="width: 0%"></div></div>
    <input type="text" id="test3-input" placeholder="ã“ã“ã§jã‚’é€£æ‰“..." autocomplete="off">
    <div class="stats">
      <div class="stat-box">
        <div class="stat-label">æ‰“éµæ•°</div>
        <div class="stat-value" id="test3-count">0</div>
      </div>
      <div class="stat-box">
        <div class="stat-label">æ‰“éµé€Ÿåº¦</div>
        <div class="stat-value" id="test3-speed">-</div>
      </div>
      <div class="stat-box">
        <div class="stat-label">å¹³å‡é–“éš”</div>
        <div class="stat-value" id="test3-interval">-</div>
      </div>
    </div>
  </div>

  <div style="text-align: center; margin: 24px 0;">
    <button onclick="analyzeResults()">ğŸ“Š çµæœã‚’åˆ†æ</button>
    <button onclick="resetAll()">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
  </div>

  <div class="result-section hidden" id="result-section">
    <h2>ğŸ“‹ åˆ†æçµæœã¨æ¨å¥¨è¨­å®š</h2>
    <div id="analysis-text"></div>
    <h3>æ¨å¥¨ã‚³ãƒãƒ³ãƒ‰</h3>
    <div class="command-box">
      <code id="recommended-command"></code>
    </div>
    <button onclick="copyCommand()">ğŸ“‹ ã‚³ãƒãƒ³ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼</button>
    <p class="description">â€» è¨­å®šå¾Œã¯ãƒ­ã‚°ã‚¢ã‚¦ãƒˆâ†’ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™</p>
  </div>

  <footer>
    <a href="https://mayholiholi.github.io/">mayholiholi</a>
  </footer>

  <script>
    // ãƒ†ã‚¹ãƒˆ1: å˜æ‰“ãƒ†ã‚¹ãƒˆ
    const test1 = {
      lastKey: '',
      lastTime: 0,
      repeatCount: 0,
      charCount: 0
    };

    document.getElementById('test1-input').addEventListener('keydown', (e) => {
      const now = Date.now();
      const timeDiff = now - test1.lastTime;

      // åŒã˜ã‚­ãƒ¼ãŒ50msä»¥å†…ã«æ¥ãŸã‚‰ãƒªãƒ”ãƒ¼ãƒˆã¨ã¿ãªã™
      if (e.key === test1.lastKey && timeDiff < 50) {
        test1.repeatCount++;
        document.getElementById('test1-repeats').textContent = test1.repeatCount;
        document.getElementById('test1-repeats').classList.add('warning');
      }

      test1.lastKey = e.key;
      test1.lastTime = now;
    });

    document.getElementById('test1-input').addEventListener('input', (e) => {
      test1.charCount = e.target.value.length;
      document.getElementById('test1-count').textContent = test1.charCount;

      const result = document.getElementById('test1-result');
      if (test1.repeatCount === 0 && test1.charCount >= 5) {
        result.textContent = 'âœ“ OK';
        result.classList.add('success');
        result.classList.remove('warning');
      } else if (test1.repeatCount > 0) {
        result.textContent = 'âš  è¦èª¿æ•´';
        result.classList.add('warning');
        result.classList.remove('success');
      }
    });

    // ãƒ†ã‚¹ãƒˆ2: é•·æŠ¼ã—ãƒ†ã‚¹ãƒˆ
    const test2 = {
      keyDownTime: 0,
      firstRepeatTime: 0,
      repeatCount: 0,
      repeatTimes: [],
      isHolding: false
    };

    document.getElementById('test2-input').addEventListener('keydown', (e) => {
      if (e.key !== 'a') return;

      if (!test2.isHolding) {
        test2.keyDownTime = Date.now();
        test2.isHolding = true;
        test2.repeatCount = 0;
        test2.repeatTimes = [];
      } else {
        // ãƒªãƒ”ãƒ¼ãƒˆç™ºç”Ÿ
        const now = Date.now();
        if (test2.repeatCount === 0) {
          test2.firstRepeatTime = now;
          const delay = now - test2.keyDownTime;
          document.getElementById('test2-delay').textContent = delay + 'ms';
        }
        test2.repeatTimes.push(now);
        test2.repeatCount++;

        if (test2.repeatTimes.length >= 2) {
          const intervals = [];
          for (let i = 1; i < test2.repeatTimes.length; i++) {
            intervals.push(test2.repeatTimes[i] - test2.repeatTimes[i-1]);
          }
          const avgInterval = Math.round(intervals.reduce((a,b) => a+b, 0) / intervals.length);
          const rate = Math.round(1000 / avgInterval);
          document.getElementById('test2-rate').textContent = rate + 'å›/ç§’';

          const result = document.getElementById('test2-result');
          if (rate > 30) {
            result.textContent = 'âš  é€Ÿã™ã';
            result.classList.add('warning');
          } else if (rate < 5) {
            result.textContent = 'âš  é…ã™ã';
            result.classList.add('warning');
          } else {
            result.textContent = 'âœ“ OK';
            result.classList.add('success');
          }
        }
      }
    });

    document.getElementById('test2-input').addEventListener('keyup', (e) => {
      if (e.key === 'a') {
        test2.isHolding = false;
      }
    });

    // ãƒ†ã‚¹ãƒˆ3: é€£æ‰“ãƒ†ã‚¹ãƒˆ
    const test3 = {
      startTime: 0,
      keyTimes: [],
      isRunning: false,
      timerId: null
    };

    document.getElementById('test3-input').addEventListener('keydown', (e) => {
      if (e.key !== 'j') return;

      const now = Date.now();

      if (!test3.isRunning) {
        test3.isRunning = true;
        test3.startTime = now;
        test3.keyTimes = [now];

        // 5ç§’é–“ã®ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼
        let elapsed = 0;
        test3.timerId = setInterval(() => {
          elapsed += 100;
          const progress = Math.min(100, (elapsed / 5000) * 100);
          document.getElementById('test3-progress').style.width = progress + '%';

          if (elapsed >= 5000) {
            clearInterval(test3.timerId);
            test3.isRunning = false;
            document.getElementById('test3-input').blur();
          }
        }, 100);
      } else {
        test3.keyTimes.push(now);
      }

      document.getElementById('test3-count').textContent = test3.keyTimes.length;

      if (test3.keyTimes.length >= 2) {
        const duration = (now - test3.startTime) / 1000;
        const speed = Math.round(test3.keyTimes.length / duration * 10) / 10;
        document.getElementById('test3-speed').textContent = speed + 'å›/ç§’';

        const intervals = [];
        for (let i = 1; i < test3.keyTimes.length; i++) {
          intervals.push(test3.keyTimes[i] - test3.keyTimes[i-1]);
        }
        const avgInterval = Math.round(intervals.reduce((a,b) => a+b, 0) / intervals.length);
        document.getElementById('test3-interval').textContent = avgInterval + 'ms';
      }
    });

    // çµæœåˆ†æ
    function analyzeResults() {
      const section = document.getElementById('result-section');
      section.classList.remove('hidden');

      let analysis = '';
      let keyRepeat = 6;  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
      let initialKeyRepeat = 25;  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ

      // ãƒ†ã‚¹ãƒˆ1ã®çµæœã‚’åæ˜ 
      if (test1.repeatCount > 0) {
        analysis += '<p class="warning">âš  å˜æ‰“æ™‚ã«æ„å›³ã—ãªã„ãƒªãƒ”ãƒ¼ãƒˆãŒç™ºç”Ÿã—ã¦ã„ã¾ã™ã€‚ãƒªãƒ”ãƒ¼ãƒˆé–‹å§‹ã¾ã§ã®æ™‚é–“ã‚’é•·ãã™ã‚‹ã“ã¨ã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚</p>';
        initialKeyRepeat = Math.min(35, initialKeyRepeat + 5 * test1.repeatCount);
      } else if (test1.charCount >= 5) {
        analysis += '<p class="success">âœ“ å˜æ‰“ãƒ†ã‚¹ãƒˆã¯å•é¡Œãªã—ã§ã™ã€‚</p>';
      }

      // ãƒ†ã‚¹ãƒˆ2ã®çµæœã‚’åæ˜ 
      const delayText = document.getElementById('test2-delay').textContent;
      const rateText = document.getElementById('test2-rate').textContent;

      if (delayText !== '-') {
        const delay = parseInt(delayText);
        if (delay < 300) {
          analysis += '<p class="warning">âš  ãƒªãƒ”ãƒ¼ãƒˆé–‹å§‹ãŒé€Ÿã™ãã¾ã™ï¼ˆ' + delay + 'msï¼‰ã€‚èª¤å…¥åŠ›ã®åŸå› ã«ãªã‚Šã¾ã™ã€‚</p>';
          initialKeyRepeat = Math.max(initialKeyRepeat, 30);
        } else if (delay > 800) {
          analysis += '<p>ğŸ’¡ ãƒªãƒ”ãƒ¼ãƒˆé–‹å§‹ã¾ã§æ™‚é–“ãŒã‹ã‹ã£ã¦ã„ã¾ã™ï¼ˆ' + delay + 'msï¼‰ã€‚é•·æŠ¼ã—æ“ä½œãŒå¤šã„å ´åˆã¯çŸ­ãã—ã¦ã‚‚è‰¯ã„ã‹ã‚‚ã€‚</p>';
        } else {
          analysis += '<p class="success">âœ“ ãƒªãƒ”ãƒ¼ãƒˆé–‹å§‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¯é©åˆ‡ã§ã™ã€‚</p>';
        }
      }

      if (rateText !== '-') {
        const rate = parseInt(rateText);
        if (rate > 30) {
          analysis += '<p class="warning">âš  ãƒªãƒ”ãƒ¼ãƒˆé€Ÿåº¦ãŒé€Ÿã™ãã¾ã™ï¼ˆ' + rate + 'å›/ç§’ï¼‰ã€‚</p>';
          keyRepeat = Math.min(10, keyRepeat + 2);
        } else if (rate < 8) {
          analysis += '<p>ğŸ’¡ ãƒªãƒ”ãƒ¼ãƒˆé€Ÿåº¦ãŒã‚„ã‚„é…ã‚ã§ã™ï¼ˆ' + rate + 'å›/ç§’ï¼‰ã€‚</p>';
        } else {
          analysis += '<p class="success">âœ“ ãƒªãƒ”ãƒ¼ãƒˆé€Ÿåº¦ã¯é©åˆ‡ã§ã™ã€‚</p>';
        }
      }

      // ãƒ†ã‚¹ãƒˆ3ã®çµæœã‚’åæ˜ 
      const intervalText = document.getElementById('test3-interval').textContent;
      if (intervalText !== '-') {
        const interval = parseInt(intervalText);
        const typingSpeed = document.getElementById('test3-speed').textContent;
        analysis += '<p>ğŸ“Š ã‚ãªãŸã®é€£æ‰“é€Ÿåº¦: ' + typingSpeed + 'ï¼ˆå¹³å‡é–“éš”: ' + interval + 'msï¼‰</p>';

        // é€£æ‰“é€Ÿåº¦ã«åŸºã¥ã„ã¦èª¿æ•´
        if (interval < 80) {
          analysis += '<p class="success">âœ“ ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ãŒéå¸¸ã«é€Ÿã„ã§ã™ï¼ç¾åœ¨ã®è¨­å®šã§ã‚‚å•é¡Œãªã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚</p>';
        } else if (interval > 150) {
          analysis += '<p>ğŸ’¡ ã‚†ã£ãã‚Šç›®ã®ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã§ã™ã€‚ãƒªãƒ”ãƒ¼ãƒˆé€Ÿåº¦ã¯é…ã‚ãŒå¿«é©ã‹ã‚‚ã€‚</p>';
          keyRepeat = Math.max(keyRepeat, 8);
        }
      }

      // æœ€çµ‚æ¨å¥¨
      analysis += '<h3>ğŸ’¡ æ¨å¥¨è¨­å®š</h3>';
      analysis += '<ul>';
      analysis += '<li><strong>KeyRepeat:</strong> ' + keyRepeat + 'ï¼ˆãƒªãƒ”ãƒ¼ãƒˆé€Ÿåº¦ã€‚å°ã•ã„ã»ã©é€Ÿã„ï¼‰</li>';
      analysis += '<li><strong>InitialKeyRepeat:</strong> ' + initialKeyRepeat + 'ï¼ˆãƒªãƒ”ãƒ¼ãƒˆé–‹å§‹ã¾ã§ã®æ™‚é–“ã€‚å°ã•ã„ã»ã©çŸ­ã„ï¼‰</li>';
      analysis += '</ul>';

      document.getElementById('analysis-text').innerHTML = analysis;

      const command = `defaults write NSGlobalDomain KeyRepeat -int ${keyRepeat} && defaults write NSGlobalDomain InitialKeyRepeat -int ${initialKeyRepeat}`;
      document.getElementById('recommended-command').textContent = command;

      section.scrollIntoView({ behavior: 'smooth' });
    }

    function copyCommand() {
      const command = document.getElementById('recommended-command').textContent;
      navigator.clipboard.writeText(command).then(() => {
        alert('ã‚³ãƒãƒ³ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚');
      });
    }

    function resetAll() {
      // ãƒ†ã‚¹ãƒˆ1ãƒªã‚»ãƒƒãƒˆ
      test1.lastKey = '';
      test1.lastTime = 0;
      test1.repeatCount = 0;
      test1.charCount = 0;
      document.getElementById('test1-input').value = '';
      document.getElementById('test1-count').textContent = '0';
      document.getElementById('test1-repeats').textContent = '0';
      document.getElementById('test1-repeats').classList.remove('warning');
      document.getElementById('test1-result').textContent = '-';
      document.getElementById('test1-result').classList.remove('success', 'warning');

      // ãƒ†ã‚¹ãƒˆ2ãƒªã‚»ãƒƒãƒˆ
      test2.keyDownTime = 0;
      test2.firstRepeatTime = 0;
      test2.repeatCount = 0;
      test2.repeatTimes = [];
      test2.isHolding = false;
      document.getElementById('test2-input').value = '';
      document.getElementById('test2-delay').textContent = '-';
      document.getElementById('test2-rate').textContent = '-';
      document.getElementById('test2-result').textContent = '-';
      document.getElementById('test2-result').classList.remove('success', 'warning');

      // ãƒ†ã‚¹ãƒˆ3ãƒªã‚»ãƒƒãƒˆ
      if (test3.timerId) clearInterval(test3.timerId);
      test3.startTime = 0;
      test3.keyTimes = [];
      test3.isRunning = false;
      document.getElementById('test3-input').value = '';
      document.getElementById('test3-count').textContent = '0';
      document.getElementById('test3-speed').textContent = '-';
      document.getElementById('test3-interval').textContent = '-';
      document.getElementById('test3-progress').style.width = '0%';

      // çµæœã‚»ã‚¯ã‚·ãƒ§ãƒ³éè¡¨ç¤º
      document.getElementById('result-section').classList.add('hidden');
    }
  </script>
</body>
</html>
